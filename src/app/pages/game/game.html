<h2>ğŸ® Team Quiz</h2>

<div *ngIf="!(state$ | async)">Waiting for game stateâ€¦</div>

<ng-container *ngIf="state$ | async as state">
  <!-- HOST: Invite players -->
  <div *ngIf="state.hostId === socket.playerId" class="share-box">
    <strong>Invite players</strong>
    <div class="invite-row">
      <span>{{ origin }}/join/{{ socket.sessionId }}</span>
      <button (click)="copyLink()">ğŸ“‹ Copy</button>
    </div>
    <small
      >Or join with code: <b>{{ socket.sessionId }}</b></small
    >
  </div>

  <div *ngIf="state.phase === 'ENDED'" class="game-over">
    <h2>ğŸ Game Over</h2>
    <h1>ğŸ† {{ getWinningTeam(state.players) }} Wins!</h1>
  </div>

  <!-- QUESTION -->
  <div class="question-box" *ngIf="state.question">
    <h2>{{ state.question }}</h2>
  </div>

  <!-- WINNER BANNER -->
  <div class="winner-banner" *ngIf="getWinner(state) as winner">
    ğŸ”¥ <b>{{ winner.name }}</b> ({{ winner.team }}) buzzed first!
  </div>

  <!-- BUZZ BUTTON -->
  <div class="buzz-container">
    <button
      *ngIf="state.phase !== 'ENDED'"
      class="buzz-btn"
      [disabled]="state.phase !== 'QUESTION_LIVE' || !state.buzzerEnabled"
      (click)="buzz()"
    >
      ğŸ”´ BUZZ
    </button>
  </div>

  <!-- SCOREBOARD -->
  <div class="scoreboard">
    <div class="team-scores">
      <h3>ğŸ† Team Scores</h3>
      <ul>
        <li *ngFor="let team of getTeamScores(state.players) | keyvalue">
          {{ team.key }} â€” <b>{{ team.value }}</b>
        </li>
      </ul>
    </div>

    <h3>Scores</h3>
    <ul>
      <li *ngFor="let p of state.players">
        {{ p.name }} <small>({{ p.team }})</small> â€” <b>{{ p.score }}</b>
      </li>
    </ul>
  </div>

  <!-- HOST CONTROLS -->
  <div *ngIf="state.hostId === socket.playerId" class="host-panel">
    <h3>Host Controls</h3>

    <input #q placeholder="Enter question" />

    <div class="host-actions">
      <button (click)="showQuestion(q.value)">Show Question</button>
      <button (click)="enableBuzzers()" [disabled]="state.phase !== 'QUESTION_DISPLAYED'">
        Enable Buzzers
      </button>
      <div *ngIf="state.phase === 'QUESTION_LIVE'">Buzzers activeâ€¦</div>
    </div>

    <div *ngIf="state.currentBuzzPlayerId" class="judge-actions">
      <button class="correct" (click)="markCorrect()">âœ… Correct</button>
      <button class="wrong" (click)="markWrong()">âŒ Wrong</button>
    </div>

    <button (click)="nextQuestion()">â¡ï¸ Next Question</button>
    <button (click)="endGame()">ğŸ End Game</button>
  </div>
</ng-container>
