<div
  class="game-container"
  *ngIf="state$ | async as state"
  [class.host-view]="state.hostId === socket.playerId"
  [class.player-view]="state.hostId !== socket.playerId"
>
  <!-- HEADER -->
  <header class="game-header">
    <h1>ğŸ® Team Quiz Night</h1>

    <div class="player-info" *ngIf="state.phase !== 'ENDED'">
      ğŸ‘¤ {{ getCurrentPlayer(state)?.name }}
      <span class="team">({{ getCurrentPlayer(state)?.team }})</span>
    </div>
  </header>

  <!-- ================= NORMAL GAME VIEW ================= -->
  <ng-container *ngIf="state.phase !== 'ENDED'; else leaderboardView">
    <!-- ROUND INFO -->
    <div class="round-info" *ngIf="state.roundName">â­ Round: {{ state.roundName }}</div>

    <!-- QUESTION AREA -->
    <section class="question-area">
      <div class="question-card" *ngIf="state.question; else waiting">
        {{ state.question }}
      </div>

      <ng-template #waiting>
        <div class="question-card waiting">â³ Waiting for next questionâ€¦</div>
      </ng-template>
    </section>

    <!-- BUZZER AREA -->
    <section class="action-area">
      <button
        class="buzz-btn"
        [disabled]="state.phase !== 'QUESTION_LIVE' || !state.buzzerEnabled"
        (click)="buzz()"
      >
        ğŸ”´ BUZZ NOW
      </button>

      <div class="winner-banner" *ngIf="getWinner(state) as winner">
        âš¡ {{ winner.name }} ({{ winner.team }}) buzzed first!
      </div>
    </section>

    <!-- TEAM SCORES -->
    <section class="scores-area">
      <h3>ğŸ† Team Scores</h3>
      <div class="scores-grid">
        <div class="team-score" *ngFor="let team of getTeamScores(state.players) | keyvalue">
          <div class="team-name">{{ team.key }}</div>
          <div class="team-points">{{ team.value }}</div>
        </div>
      </div>
    </section>

    <!-- HOST CONTROLS -->
    <section *ngIf="state.hostId === socket.playerId" class="host-panel">
      <h3>ğŸ‘‘ Host Controls</h3>

      <button *ngIf="state.phase === 'WAITING'" (click)="nextQuestion()">
        â–¶ï¸ Start Next Question
      </button>

      <button *ngIf="state.phase === 'QUESTION_DISPLAYED'" (click)="enableBuzzers()">
        ğŸ”” Enable Buzzers
      </button>

      <div *ngIf="state.currentBuzzPlayerId" class="answer-controls">
        <button class="correct" (click)="markCorrect()">âœ… Correct</button>
        <button class="wrong" (click)="markWrong()">âŒ Wrong</button>
      </div>

      <button class="end-btn" (click)="endGame()">ğŸ End Game</button>
    </section>
  </ng-container>

  <!-- ================= LEADERBOARD VIEW ================= -->
  <ng-template #leaderboardView>
    <section class="leaderboard">
      <h1>ğŸ Game Over</h1>
      <h2>ğŸ† Final Leaderboard</h2>

      <div class="leaderboard-list">
        <div
          class="leaderboard-item"
          *ngFor="let p of getPlayersSortedByScore(state.players)"
          [class.winner]="p.score === state.topScore"
        >
          <span class="name">{{ p.name }}</span>
          <span class="team">({{ p.team }})</span>
          <span class="score">{{ p.score }}</span>
        </div>
      </div>

      <!-- WINNER QR REWARD -->
      <div class="winner-reward" *ngIf="state.individualWinner as winner">
        <h2>ğŸ‰ Winner: {{ winner.name }}</h2>

        <div class="qr-box">
          <img src="assets/reward-qr.png" alt="Reward QR" />
        </div>

        <p>Scan to claim your reward ğŸ</p>
      </div>
    </section>
  </ng-template>
</div>
